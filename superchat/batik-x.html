<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Batik X</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ! tailwindcss v3.4.1 | MIT License | https://tailwindcss.com */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb
        }

        ::after,
        ::before {
            --tw-content: ''
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        [type=button],
        [type=reset],
        [type=submit],
        button {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0;
            padding: 0
        }

        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden] {
            display: none
        }

        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia:
        }

        .fixed {
            position: fixed
        }

        .absolute {
            position: absolute
        }

        .relative {
            position: relative
        }

        .inset-y-0 {
            top: 0px;
            bottom: 0px
        }

        .bottom-0 {
            bottom: 0px
        }

        .right-0 {
            right: 0px
        }

        .z-10 {
            z-index: 10
        }

        .mt-2 {
            margin-top: 0.5rem
        }

        .flex {
            display: flex
        }

        .h-14 {
            height: 3.5rem
        }

        .h-5 {
            height: 1.25rem
        }

        .h-8 {
            height: 2rem
        }

        .h-screen {
            height: 100vh
        }

        .w-11\/12 {
            width: 91.666667%
        }

        .w-14 {
            width: 3.5rem
        }

        .w-full {
            width: 100%
        }

        .resize-none {
            resize: none
        }

        .flex-col {
            flex-direction: column
        }

        .items-center {
            align-items: center
        }

        .justify-start {
            justify-content: flex-start
        }

        .justify-center {
            justify-content: center
        }

        .overflow-y-auto {
            overflow-y: auto
        }

        .rounded-full {
            border-radius: 9999px
        }

        .border {
            border-width: 1px
        }

        .border-gray-200 {
            --tw-border-opacity: 1;
            border-color: rgb(229 231 235 / var(--tw-border-opacity))
        }

        .bg-gray-50 {
            --tw-bg-opacity: 1;
            background-color: rgb(249 250 251 / var(--tw-bg-opacity))
        }

        .bg-transparent {
            background-color: transparent
        }

        .bg-white {
            --tw-bg-opacity: 1;
            background-color: rgb(255 255 255 / var(--tw-bg-opacity))
        }

        .bg-gradient-to-r {
            background-image: linear-gradient(to right, var(--tw-gradient-stops))
        }

        .from-pink-200 {
            --tw-gradient-from: #fbcfe8 var(--tw-gradient-from-position);
            --tw-gradient-to: rgb(251 207 232 / 0) var(--tw-gradient-to-position);
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
        }

        .via-red-300 {
            --tw-gradient-to: rgb(252 165 165 / 0) var(--tw-gradient-to-position);
            --tw-gradient-stops: var(--tw-gradient-from), #fca5a5 var(--tw-gradient-via-position), var(--tw-gradient-to)
        }

        .to-purple-300 {
            --tw-gradient-to: #d8b4fe var(--tw-gradient-to-position)
        }

        .p-4 {
            padding: 1rem
        }

        .px-5 {
            padding-left: 1.25rem;
            padding-right: 1.25rem
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem
        }

        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem
        }

        .pb-8 {
            padding-bottom: 2rem
        }

        .pr-20 {
            padding-right: 5rem
        }

        .text-center {
            text-align: center
        }

        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem
        }

        .font-medium {
            font-weight: 500
        }

        .text-gray-400 {
            --tw-text-opacity: 1;
            color: rgb(156 163 175 / var(--tw-text-opacity))
        }

        .text-purple-800 {
            --tw-text-opacity: 1;
            color: rgb(107 33 168 / var(--tw-text-opacity))
        }

        .underline {
            -webkit-text-decoration-line: underline;
            text-decoration-line: underline
        }

        .opacity-0 {
            opacity: 0
        }

        .backdrop-blur-sm {
            --tw-backdrop-blur: blur(4px);
            -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
            backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)
        }

        .backdrop-blur-xl {
            --tw-backdrop-blur: blur(24px);
            -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
            backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px
        }

        .focus\:ring-1:focus {
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)
        }

        .focus\:ring-purple-800:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgb(107 33 168 / var(--tw-ring-opacity))
        }

        @media (min-width: 768px) {
            .md\:w-8\/12 {
                width: 66.666667%
            }

            .md\:w-9\/12 {
                width: 75%
            }
        }
    </style>
</head>

<body>
    <div class="flex justify-center bg-gray-50">
        <div class="h-screen w-full overflow-y-auto md:w-8/12">

            <div class="fixed flex w-full items-center justify-start px-6 py-3 backdrop-blur-xl md:w-8/12">
                <div class="flex h-14 w-14 items-center justify-center rounded-full bg-white">
                    <!-- LOGO -->
                    <img class="h-8" src="https://sarya.com/img/batik-x.svg">
                </div>

                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <!-- <img class="h-5 " src="https://mj-cycls.github.io/sarya-web/img/sarya.svg"> -->
                <!-- NAME -->
                <p class="text-xl tracking-wider text-gray-700">Batik X</p>
            </div>

            <!-- <div class="fixed bottom-0 z-10 flex w-full justify-center pb-8 md:w-8/12">
          <div class="relative flex w-11/12 items-center justify-center md:w-9/12">
            <textarea id="userInput" placeholder="Send a message" class="w-full resize-none rounded-full border border-gray-200 focus:outline-none focus:ring-1 focus:ring-purple-800 text-purple-800 bg-transparent p-4 backdrop-blur-sm" rows="1" cols="50"></textarea>
            <button id="sendButton" class="absolute inset-y-0 right-0 px-5 text-gray-400">Send</button>
          </div>
        </div> -->

            <div class="fixed bottom-0 z-10 flex w-full justify-center pb-8 md:w-8/12">
                <div class="relative flex w-11/12 flex-col items-center justify-center md:w-9/12">
                    <div
                         class="relative flex w-full items-center rounded-full border border-gray-200 bg-transparent backdrop-blur-sm">
                        <textarea id="userInput" placeholder="Send a message"
                                  class="w-full resize-none rounded-full bg-transparent p-4 pr-20 text-purple-800 focus:outline-none focus:ring-1 focus:ring-purple-800"
                                  rows="1" cols="50"></textarea>
                        <button id="sendButton" class="absolute inset-y-0 right-0 px-5 text-gray-400">Send</button>
                    </div>
                    <div class="mt-2 w-full text-center text-xs text-gray-400">Powered by <a href="https://sarya.com"
                           class="font-medium underline">Sarya</a></div>
                </div>
            </div>


            <div class="">
                <div class="h-5 bg-gradient-to-r from-pink-200 via-red-300 to-purple-300"></div>

                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>



                <div id="responseArea"></div>


                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <p class="opacity-0">.</p>
                <p id="roll" class="opacity-0">.</p>
            </div>
        </div>
    </div>


    <script type="text/javascript">
        function getQueryParam(param) {
            var searchParams = new URLSearchParams(window.location.search);
            return searchParams.get(param);
        }

        // Set the default text in the input field
        window.onload = function () {
            var defaultText = getQueryParam('text');
            if (defaultText) { document.getElementById('userInput').value = defaultText }
        }

        // Global memory for the chat history
        // var meta={};
        var release = null;
        //<!-- HANDLER -->
        var appHandler = "x-ray11";
        var conversationId = null;

        document.getElementById('sendButton').addEventListener('click', sendMessage);

        // Eneter
        var textarea = document.getElementById('userInput');
        textarea.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') { e.preventDefault(); sendMessage() }
        })
        // auto focus
        document.addEventListener('DOMContentLoaded', function () { document.getElementById('userInput').focus() })
        //


        function sendMessage() {
            var userText = document.getElementById('userInput').value; if (!userText.trim()) return; // Don't send empty messages
            // Update UI immediately to show the message being sent
            addToChat(userText, 'You');
            // var requestData={"dir":"req","body":[{"type":"Text","content":userText}],"meta":memory};

            var requestData = {/*"dir":"req",*/"body": { "type": "text", "text": userText },
                "release": release,/*"meta":meta,*/"app_handler": appHandler, "conversation_id": conversationId
            };
            console.log(requestData)
            document.getElementById('userInput').value = '';

            fetch('https://api.sarya.com/', {


                method: 'POST', headers: { "Accept": "application/json", "Content-Type": "application/json", "x-version": "2023-06", "x-language": "en" },
                body: JSON.stringify(requestData),
            })
                .then(response => response.json())
                .then(response => {
                    console.log(response);
                    release = response.release; appHandler = response.app_handler; conversationId = response.conversation_id;
                    response.body.forEach(
                        // function(entry){addToChat(entry.content,'Other',entry.type);
                        function (entry) { addToChat(entry.text, 'Other', entry.type); });
                    // meta=response.meta;
                    // release=response.release;
                    // appHandler=response.appHandler;
                    // conversationId=response.conversationId;
                })
                .catch(error => {
                    addToChat("Error occurred.", 'Error');
                });
        }

        function timestamp() { var now = new Date(); return now.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' }) }

        function addToChat(message, speaker, type = "text") {
            let chatBubble = document.createElement('div');
            var render = ''
            if (type === "text") { render = `<span>${message}<span>` }
            else if (type === "image") { render = `<img class="image-roll w-auto max-w-md rounded-lg" src="${message}"/>` }
            else { render = `<span>sorry, couldn't show<span>` }

            chatBubble.innerHTML =
                `<div class="flex items-start md:w-8/12 p-1 pl-4">
  <div class="p-2">
  ${speaker === 'You' ?
                    '<div class="h-8 w-8 rounded-full bg-gradient-to-r from-pink-300 to-purple-400"></div>' :
                    '<div class="h-8 w-8 rounded-full bg-gradient-to-r from-yellow-200 to-orange-400"></div>'}
  </div>
  <div class="rounded-2xl border border-gray-200 p-2">
    ${render}
    <p class="pt-2 text-right text-xs text-gray-400">${speaker === 'You' ? '@you ' + timestamp() + ' ' : '@' + appHandler + ' ' + timestamp() + ' ✓'}</p>
  </div>
</div>`;

            document.getElementById('responseArea').appendChild(chatBubble);
            // regular-roll
            var elementToScrollTo = document.getElementById('roll')
            elementToScrollTo.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' })
            // image-roll
            var images = document.querySelectorAll('.image-roll');
            images.forEach(function (image) {
                image.addEventListener('load', function () {
                    elementToScrollTo.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' })
                })
            })
            // NEXT, small vdom

        }
    </script>


</body>

</html>
